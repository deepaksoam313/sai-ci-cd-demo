name: Build Java JAR

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: self-hosted

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Java 21
      uses: actions/setup-java@v3
      with:
        distribution: 'temurin'
        java-version: '21'

    - name: List files (debug)
      run: ls -R

    - name: Compile Java
      run: javac HelloServer.java

    - name: Create manifest
      run: |
        mkdir -p META-INF
        echo "Manifest-Version: 1.0" > META-INF/MANIFEST.MF
        echo "Main-Class: HelloServer" >> META-INF/MANIFEST.MF

    - name: Create JAR
      run: jar cfm helloserver.jar META-INF/MANIFEST.MF *.class

    - name: Upload artifact
      uses: actions/upload-artifact@v4
      with:
        name: helloserver-jar
        path: helloserver.jar
